<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Sharing - Urban Farming Solutions</title>
    <style>
        /* Makes sure nothing has extra space by default */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f9f9f9;
        }

        /* Green header at top */
        header {
            background-color: #2c7744;
            color: white;
            padding: 1rem;
            text-align: center;
            position: relative;
        }

        /* Login/logout area in top right */
        .user-menu {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }

            .user-menu a {
                color: white;
                text-decoration: none;
                font-weight: bold;
            }

                .user-menu a:hover {
                    text-decoration: underline;
                }

        /* Navigation menu */
        nav {
            background-color: #1c5e30;
            padding: 0.5rem;
        }

            nav ul {
                display: flex;
                justify-content: center;
                list-style: none;
            }

                nav ul li {
                    margin: 0 1rem;
                }

                    nav ul li a {
                        color: white;
                        text-decoration: none;
                        font-weight: bold;
                    }

        /* Centers all content */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Blue section for resources */
        .resource-section {
            background-color: #e3f2fd;
            padding: 2rem;
            border-radius: 5px;
            margin-bottom: 2rem;
        }

        h1, h2, h3 {
            color: #2c7744;
            margin-bottom: 1rem;
        }

        /* White box for the sharing form */
        .resource-form-container {
            background-color: white;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Space between form fields */
        .form-group {
            margin-bottom: 1.5rem;
        }

        /* Text above each input */
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #2c7744;
        }

        /* Input boxes, dropdowns, and text areas */
        input, select, textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            font-family: inherit;
        }

        /* Makes text area taller */
        textarea {
            min-height: 120px;
        }

        /* Green button */
        .btn {
            display: inline-block;
            background-color: #2c7744;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
        }

            .btn:hover {
                background-color: #1c5e30;
            }

        /* Message box for users who aren't logged in */
        .login-message {
            text-align: center;
            padding: 1.5rem;
            background-color: #e8f5e9;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 5px solid #2c7744;
        }

            .login-message a {
                color: #2c7744;
                font-weight: bold;
            }

        /* Container for all the resource cards */
        .resources-container {
            margin-top: 2rem;
        }

        /* Grid layout for resource cards */
        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        /* Individual resource cards */
        .resource-card {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

            /* Card lifts up when you hover over it */
            .resource-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            }

            .resource-card h3 {
                color: #2c7744;
                margin-bottom: 0.5rem;
                border-bottom: 2px solid #e8f5e9;
                padding-bottom: 0.5rem;
            }

        /* Resource details in each card */
        .resource-info {
            margin-bottom: 0.5rem;
        }

            .resource-info strong {
                color: #2c7744;
            }

        /* Who shared the resource */
        .resource-owner {
            margin-top: 1rem;
            font-style: italic;
            color: #666;
        }

        /* Footer at bottom */
        footer {
            background-color: #2c7744;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
        }

        /* Makes the site work on phones */
        @media (max-width: 768px) {
            nav ul {
                flex-direction: column;
                align-items: center;
            }

                nav ul li {
                    margin: 0.5rem 0;
                }

            .resource-grid {
                grid-template-columns: 1fr;
            }

            .user-menu {
                position: static;
                text-align: center;
                margin-top: 1rem;
                background-color: transparent;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Urban Farming Solutions</h1>
        <p>Resource Sharing Network</p>
        <div id="user-account" class="user-menu">
            <!-- JavaScript adds login/logout buttons here -->
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/#growing">Growing Guides</a></li>
            <li><a href="/#education">Education</a></li>
            <li><a href="/resource-sharing.html">Resource Sharing</a></li>
            <li><a href="/#about">About Us</a></li>
        </ul>
    </nav>

    <main>
        <h2>Resource Sharing Network</h2>
        <p>Connect with other urban farmers to share seeds, tools, and containers. Reduce waste and costs while building community!</p>

        <div id="auth-required-section">
            <!-- Form that shows only when logged in -->
            <div id="resource-form-section" style="display: none;">
                <div class="resource-form-container">
                    <h3>Share a Resource</h3>
                    <form id="resource-form">
                        <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" id="title" name="title" required>
                        </div>

                        <div class="form-group">
                            <label for="category">Category</label>
                            <select id="category" name="category" required>
                                <option value="">Select a category</option>
                                <option value="Seeds">Seeds</option>
                                <option value="Tools">Tools</option>
                                <option value="Containers">Containers</option>
                                <option value="Soil">Soil & Compost</option>
                                <option value="Plants">Plants & Seedlings</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea id="description" name="description" required></textarea>
                        </div>

                        <div class="form-group">
                            <label for="quantity">Quantity</label>
                            <input type="number" id="quantity" name="quantity" min="1" required>
                        </div>

                        <div class="form-group">
                            <label for="location">Location</label>
                            <input type="text" id="location" name="location" placeholder="City, State/Province" required>
                        </div>

                        <div class="form-group">
                            <label for="contactInfo">Contact Information</label>
                            <input type="text" id="contactInfo" name="contactInfo" required>
                        </div>

                        <button type="submit" class="btn">Share Resource</button>
                    </form>
                </div>
            </div>

            <!-- Message that shows when not logged in -->
            <div id="login-message" style="display: none;">
                <div class="login-message">
                    <p>Please <a href="/login.html">login</a> or <a href="/register.html">register</a> to share your resources.</p>
                </div>
            </div>
        </div>

        <!-- Where all the shared resources appear -->
        <div class="resources-container">
            <h3>Available Resources</h3>
            <div id="resources-grid" class="resource-grid">
                <p>Loading resources...</p>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Urban Farming Solutions. All rights reserved.</p>
        <p>Fighting world hunger through sustainable urban agriculture.</p>
    </footer>

    <script>
        // Runs when the page loads
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Check if user is logged in
                const response = await fetch('/check-auth');
                const data = await response.json();

                // Get the parts of the page we need to update
                const userAccountDiv = document.getElementById('user-account');
                const resourceFormSection = document.getElementById('resource-form-section');
                const loginMessage = document.getElementById('login-message');

                if (data.isAuthenticated) {
                    // User is logged in - show their name and the form
                    userAccountDiv.innerHTML = `
                            <span>Welcome, ${data.username}! </span>
                            <a href="/profile.html">My Profile</a> |
                            <a href="/logout">Logout</a>
                        `;

                    // Show the sharing form
                    resourceFormSection.style.display = 'block';
                    loginMessage.style.display = 'none';

                    // Make the form work when submitted
                    document.getElementById('resource-form').addEventListener('submit', handleFormSubmit);
                } else {
                    // User is not logged in - show login links
                    userAccountDiv.innerHTML = `
                            <a href="/login.html">Login</a> |
                            <a href="/register.html">Register</a>
                        `;

                    // Hide form and show login message
                    resourceFormSection.style.display = 'none';
                    loginMessage.style.display = 'block';
                }

                // Show available resources for everyone
                loadResources();
            } catch (error) {
                console.error('Error checking authentication:', error);
            }
        });

        // What happens when someone shares a resource
        async function handleFormSubmit(e) {
            // Stop the form from refreshing the page
            e.preventDefault();

            // Collect all the information from the form
            const resourceData = {
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                description: document.getElementById('description').value,
                quantity: document.getElementById('quantity').value,
                location: document.getElementById('location').value,
                contactInfo: document.getElementById('contactInfo').value
            };

            try {
                // Send the resource to the server
                const response = await fetch('/api/resources', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(resourceData)
                });

                if (response.ok) {
                    // Resource shared successfully
                    alert('Resource shared successfully!');
                    document.getElementById('resource-form').reset();
                    loadResources(); // Show the new resource
                } else {
                    // Something went wrong
                    const data = await response.json();
                    alert(`Error: ${data.message || 'Failed to share resource'}`);
                }
            } catch (error) {
                console.error('Error sharing resource:', error);
                alert('Error sharing resource. Please try again.');
            }
        }

        // Gets all resources and shows them on the page
        async function loadResources() {
            const resourcesGrid = document.getElementById('resources-grid');

            try {
                // Ask server for all resources
                const response = await fetch('/api/resources');
                const resources = await response.json();

                if (resources.length === 0) {
                    // No resources yet
                    resourcesGrid.innerHTML = '<p>No resources available yet. Be the first to share!</p>';
                    return;
                }

                // Clear the loading message
                resourcesGrid.innerHTML = '';

                // Create a card for each resource
                resources.forEach(resource => {
                    const card = document.createElement('div');
                    card.className = 'resource-card';
                    card.innerHTML = `
                            <h3>${resource.title}</h3>
                            <p class="resource-info"><strong>Category:</strong> ${resource.category}</p>
                            <p class="resource-info"><strong>Description:</strong> ${resource.description}</p>
                            <p class="resource-info"><strong>Quantity:</strong> ${resource.quantity}</p>
                            <p class="resource-info"><strong>Location:</strong> ${resource.location}</p>
                            <p class="resource-info"><strong>Contact:</strong> ${resource.contactInfo}</p>
                            <p class="resource-owner">Shared by: ${resource.ownerName}</p>
                        `;
                    resourcesGrid.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading resources:', error);
                resourcesGrid.innerHTML = '<p>Error loading resources. Please try again later.</p>';
            }
        }
    </script>
</body>
</html>